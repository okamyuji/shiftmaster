{{define "content"}}
<div class="space-y-6">
  <!-- ヘッダー -->
  <div class="flex items-center justify-between">
    <div>
      <a href="/schedules"
        class="inline-flex items-center gap-2 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-white transition-colors mb-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        勤務表一覧に戻る
      </a>
      <h1 class="text-2xl font-bold text-slate-900 dark:text-white">{{.Schedule.TargetPeriodLabel}} 勤務表</h1>
    </div>
    <div class="flex items-center gap-2">
      {{if eq .Schedule.Status "draft"}}
      <span
        class="px-3 py-1 text-sm font-medium rounded-full bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200">{{.Schedule.StatusLabel}}</span>
      {{else if eq .Schedule.Status "in_progress"}}
      <span
        class="px-3 py-1 text-sm font-medium rounded-full bg-yellow-100 dark:bg-yellow-600 text-yellow-800 dark:text-yellow-100">{{.Schedule.StatusLabel}}</span>
      {{else if eq .Schedule.Status "completed"}}
      <span
        class="px-3 py-1 text-sm font-medium rounded-full bg-green-100 dark:bg-green-600 text-green-800 dark:text-green-100">{{.Schedule.StatusLabel}}</span>
      {{else if eq .Schedule.Status "published"}}
      <span
        class="px-3 py-1 text-sm font-medium rounded-full bg-blue-100 dark:bg-blue-600 text-blue-800 dark:text-blue-100">{{.Schedule.StatusLabel}}</span>
      {{end}}

      {{if ne .Schedule.Status "published"}}
      <button hx-post="/schedules/{{.Schedule.ID}}/publish" hx-confirm="勤務表を公開しますか？公開後は削除できません。"
        class="btn btn-primary">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        公開
      </button>
      {{end}}
    </div>
  </div>

  <!-- 勤務表マトリックス（メイン機能なので最上部） -->
  <div class="card p-6">
    <h2 class="text-lg font-bold text-slate-900 dark:text-white mb-4">勤務表（{{.Schedule.TargetPeriodLabel}}）</h2>
    {{if .Staffs}}
    <div class="overflow-x-auto">
      <table class="w-full text-sm border-collapse">
        <thead>
          <tr class="border-b-2 border-slate-300 dark:border-slate-600">
            <th
              class="text-left py-2 px-2 text-slate-700 dark:text-slate-300 sticky left-0 bg-white dark:bg-slate-800 min-w-32 font-semibold">
              スタッフ</th>
            {{range .Dates}}
            <th
              class="text-center py-1 px-1 min-w-10 {{if .IsWeekend}}bg-red-50 dark:bg-slate-700/50{{else}}bg-slate-50 dark:bg-slate-800{{end}}">
              <div class="text-xs font-bold text-slate-800 dark:text-slate-200">{{.Day}}</div>
              <div
                class="text-xs {{if .IsWeekend}}text-red-500 dark:text-red-400 font-bold{{else}}text-slate-500 dark:text-slate-400{{end}}">
                {{.DayOfWeek}}</div>
            </th>
            {{end}}
          </tr>
        </thead>
        <tbody>
          {{$map := .StaffShiftMap}}
          {{range .Staffs}}
          {{$staffID := .ID}}
          <tr class="border-b border-slate-200 dark:border-slate-700/50 hover:bg-slate-100 dark:hover:bg-slate-700/30">
            <td class="py-2 px-2 text-slate-900 dark:text-white font-medium sticky left-0 bg-white dark:bg-slate-800">
              {{.LastName}} {{.FirstName}}</td>
            {{range $.Dates}}
            {{$entry := index (index $map $staffID) .Date}}
            <td class="text-center py-1 px-1 {{if .IsWeekend}}bg-red-50/50 dark:bg-slate-700/30{{end}}">
              {{if $entry}}
              <span
                class="inline-block px-2 py-1 text-xs font-bold rounded shadow-sm {{if $entry.ShiftTypeCode}}bg-blue-600 text-white border border-blue-700{{else}}bg-gray-200 text-gray-600 border border-gray-300{{end}}"
                title="{{if $entry.ShiftTypeName}}{{$entry.ShiftTypeName}}{{end}}">
                {{if $entry.ShiftTypeCode}}{{$entry.ShiftTypeCode}}{{else}}-{{end}}
              </span>
              {{else}}
              <span class="text-gray-300">-</span>
              {{end}}
            </td>
            {{end}}
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
    <p class="text-slate-600 dark:text-slate-400 mt-4 text-sm">登録済みエントリ: {{len .Schedule.Entries}}件</p>
    {{else}}
    <div class="text-center py-8">
      <p class="text-slate-600 dark:text-slate-400 mb-4">スタッフが登録されていません</p>
      <p class="text-sm text-slate-500">先にスタッフを登録してください</p>
    </div>
    {{end}}
  </div>

  <!-- シフト追加フォーム -->
  <div class="card p-6">
    <h2 class="text-lg font-bold text-slate-900 dark:text-white mb-4">シフト追加</h2>
    <form hx-post="/schedules/{{.Schedule.ID}}/entries" hx-swap="none" hx-on::after-request="location.reload()"
      class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <label for="staff_id" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">スタッフ *</label>
          <select id="staff_id" name="staff_id" required class="input">
            <option value="">選択してください</option>
            {{range .Staffs}}
            <option value="{{.ID}}">{{.LastName}} {{.FirstName}}</option>
            {{end}}
          </select>
        </div>
        <div>
          <label for="target_date" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">日付
            *</label>
          <input type="date" id="target_date" name="target_date" required class="input"
            min="{{.Schedule.TargetYear}}-{{printf " %02d" .Schedule.TargetMonth}}-01"
            max="{{.Schedule.TargetYear}}-{{printf " %02d" .Schedule.TargetMonth}}-{{printf "%02d"
            .Schedule.DaysInMonth}}">
        </div>
        <div>
          <label for="shift_type_id"
            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">シフト種別</label>
          <select id="shift_type_id" name="shift_type_id" class="input">
            <option value="">選択してください</option>
            {{range .ShiftTypes}}
            <option value="{{.ID}}">{{.Name}} ({{.Code}})</option>
            {{end}}
          </select>
        </div>
        <div class="flex items-end">
          <button type="submit" class="btn btn-primary w-full">
            追加
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- 基本情報カード（補助情報なので下部） -->
  <div class="card p-6">
    <h2 class="text-lg font-bold text-slate-900 dark:text-white mb-4">基本情報</h2>
    <dl class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div>
        <dt class="text-sm text-slate-500 dark:text-slate-400">対象期間</dt>
        <dd class="text-slate-900 dark:text-white font-medium">{{.Schedule.TargetPeriodLabel}}</dd>
      </div>
      <div>
        <dt class="text-sm text-slate-500 dark:text-slate-400">月の日数</dt>
        <dd class="text-slate-900 dark:text-white font-medium">{{.Schedule.DaysInMonth}}日</dd>
      </div>
      <div>
        <dt class="text-sm text-slate-500 dark:text-slate-400">作成日</dt>
        <dd class="text-slate-900 dark:text-white font-medium">{{.Schedule.CreatedAt | formatDateTime}}</dd>
      </div>
      <div>
        <dt class="text-sm text-slate-500 dark:text-slate-400">公開日</dt>
        <dd class="text-slate-900 dark:text-white font-medium">
          {{if .Schedule.PublishedAt}}{{.Schedule.PublishedAt | formatDateTime}}{{else}}-{{end}}
        </dd>
      </div>
    </dl>
  </div>
</div>
{{end}}
